---
layout: IT
title: Python Flask Extensions Tip
date: '2013-07-17'
comments: true
adsense: true
ignored: true
tags:
- development
- extensions
- flask
- IT
- Python
- tip
- web
---

<h2 id="article_summary" class="summary">파이썬 Flask 플러그인 안내와 팁.</h2><p><strong>데이터베이스</strong><br /><a title="Flask-SQLAlchemy" href="http://pythonhosted.org/Flask-SQLAlchemy/" target="_blank">Flask-SQLAlchemy</a> : OR매핑을 지원하는 플라스크용 파이썬 SQL toolkit<br />SQLAlchemy에서 상속(Inheritance) : <a title="sqlalchemy 상속" href="http://docs.sqlalchemy.org/en/rel_0_7/orm/inheritance.html" target="_blank">http://docs.sqlalchemy.org/en/rel_0_7/orm/inheritance.html</a></p><p>SQLAlchemy 컬럼에 데이터가 생성될때나 업데이트 될때 현재 시각을 자동으로 넣는 방법.<br />updated_at = db.Column(db.DateTime, default=db.func.now(), onupdate=db.func.now())</p><p><strong>로그인&middot;보안</strong><br /><a title="Flask-Social" href="http://pythonhosted.org/Flask-Social/" target="_blank">Flask-Social</a> : 소셜 네트워크와의 연결을 간편하게 해 줌.<br /><a title="Flask-Security" href="http://pythonhosted.org/Flask-Security" target="_blank">Flask Security(Auth)</a> : 로그인과 권한관리.</p><p><strong>관리자 페이지</strong><br /><a title="Flask-Admin" href="https://pypi.python.org/pypi/Flask-Admin" target="_blank">Flask-Admin</a> : 관리자 페이지를 손쉽게 만들도록 도와줌.</p><p><strong>다국어 지원</strong><br /><a title="Flask-Babel" href="https://pypi.python.org/pypi/Flask-Babel" target="_blank">Flask-Babel</a> : 파이썬용 다국어 지원 Babel의 Flask 플러그인</p><p><strong>캐쉬</strong><br /><a title="flask-cache" href="https://github.com/thadeusb/flask-cache" target="_blank">flask-cache</a> : 캐쉬 설정을 도와줌.</p><p><strong>에셋 관리</strong><br /><a title="flask-assets" href="http://elsdoerfer.name/docs/flask-assets" target="_blank">flask-assets</a> : 각종 static 에셋 관리를 편하게 도와줌.<br />사용하고자 하는 기능에 따라 추가 모듈이 필요하다. (css 압축, scss사용)<br />pip install cssmin<br />pip install pyscss<br /><strong>Flask-Assets extension에서 pyScss컴파일러 사용 설정법</strong><br /><code><br />from flask import Flask, render_template<br />from flask.ext.assets import Environment, Bundle<br /><br />app = Flask(__name__)<br /><br />assets = Environment(app)<br />assets.url = app.static_url_path<br />scss = Bundle('foo.scss', 'bar.scss', filters='pyscss', output='all.css')<br />assets.register('scss_all', scss)<br />And in the template include this:<br /><br />{% assets "scss_all" %}<br />{% endassets %}<br /></code><br />SCSS file은 debug모드에서도 컴파일 된다.<br /><p><strong>캐쉬</strong><br /><a title="Flask-Cache" href="http://pythonhosted.org/Flask-Cache/" target="_blank">Flask-Cache</a> : 플라스크에서 캐쉬 사용 하기 쉽게 도와줌.<br /><code># Flask-Cache Cache Type<br />CACHE_TYPE = 'simple' # 개발 시<br />CACHE_TYPE = 'redis' # 배포 시. redis 서버 구동 필요.<br />from flask.ext.cache import Cache<br /><br />app = Flask(__name__)<br />cache = Cache()<br />cache.init_app(app, config={'CACHE_TYPE': CACHE_TYPE})<br /></code><br /></p><p><strong>파일 업로드</strong><br /><a title="Flask-Uploads" href="http://pythonhosted.org/Flask-Uploads" target="_blank">Flask-Uploads</a> : 파일 업로드 관련 처리를 도와줌.<br /><code>from flask.ext.uploads import UploadSet<br />images = UploadSet()<br />images.__init__('upload', IMAGES)<br />filename = images.save(files, folder='/images', name='test.')<br />image_path = images.path(filename)<br />url = images.url(thumbnail)<br /></code></p><p><strong>텍스트 검색</strong><br /><a title="Flask-WhooshAlchemy" href="https://github.com/gyllstromk/Flask-WhooshAlchemy" target="_blank">Flask-WhooshAlchemy</a> : 텍스트 기반 검색을 쉽게 도와줌</p><p><strong>오류 추적</strong><br /><a title="flask-exceptional" href="https://github.com/jzempel/flask-exceptional" target="_blank">flask-exceptional</a> : 오류 추적 서비스인 <a title="exceptional" href="http://www.exceptional.io/" target="_blank">exceptional</a>를 flask에서 이용 가능하게 도와줌.</p><p><strong>전자상거래(e-commerce)</strong> [flask용 extension 아님]<br /><a title="stripe" href="https://stripe.com" target="_blank">stripe</a> : 결제 모듈을 간편하게 시스템에 붙이도록 도와주는 서비스.<br /><a title="satchmoproject" href="http://www.satchmoproject.com" target="_blank">satchmoproject</a> : 오픈소스 전자 상점 프레임워크 (<a title="satchmo wiki" href="https://bitbucket.org/chris1610/satchmo/wiki/Home" target="_blank">satchmo Wiki</a>)<br /><a title="satchless" href="http://satchless.com" target="_blank">satchless</a> : 프레임워크에 종속적이지 않은 e-commerce용 클래스와 패턴 모음<br /><a title="flamaster" href="https://github.com/MediaSapiens/flamaster" target="_blank">flamaster</a> : flask용 e-commerce eventing 시스템</p><p><strong>Flask에서 JSON 다루기(JSON Handling in Flask)</strong><br /><a title="module-flask" href="http://flask.pocoo.org/docs/api/#module-flask.json" target="_blank">http://flask.pocoo.org/docs/api/#module-flask.json</a><br /><code><br />import requests<br />r = requests.get(QUERY_URL)<br />return r.json<br />//normal return<br />return jsonify(username=g.user.username,<br />email=g.user.email,id=g.user.id)<br /></code></p><p><strong>jsonify a SQLAlchemy result set in Flask</strong><br /><a title="jsonify-a-sqlalchemy-result-set-in-flask" href="http://stackoverflow.com/questions/7102754/jsonify-a-sqlalchemy-result-set-in-flask" target="_blank">http://stackoverflow.com/questions/7102754/jsonify-a-sqlalchemy-result-set-in-flask</a><br />jsonify의 문제는 object가 자동으로 json화 되지 않는다는 것이다.<br />serialize를 위해 다음을 모델에 추가 해 준다.</p><p><code><br />def dump_datetime(value):<br />"""Deserialize datetime object into string form for JSON processing."""<br />if value is None:<br />return None<br />return [value.strftime("%Y-%m-%d"), value.strftime("%H:%M:%S")]<br /><br />class Foo(db.Model):<br />//... SQLAlchemy defs here..<br />def __init__(self, ...):<br />//self.foo = ...<br />pass<br />@property<br />def serialize(self):<br />"""Return object data in easily serializeable format"""<br />return {<br />'id'         : self.id,<br />'modified_at': dump_datetime(self.modified_at),<br /># This is an example how to deal with Many2Many relations<br />'many2many'  : self.serialize_many2many<br />}<br />@property<br />def serialize_many2many(self):<br />"""<br />Return object's relations in easily serializeable format.<br />NB! Calls many2many's serialize property.<br />"""<br />return [ item.serialize for item in self.many2many]<br /></code><br />뷰에서는 아래처럼 사용한다.<br /><code><br />return jsonify(json_list=[i.serialize for i in qryresult.all()])<br /></code></p><p><strong>gunicorn서버 사용 설정.</strong><br /><code><br />from werkzeug.contrib.fixers import ProxyFix<br />app.wsgi_app = ProxyFix(app.wsgi_app)<br /><br />if __name__ == '__main__':<br />port = int(os.environ.get('PORT', 5000))<br />app.run()<br /></code></p><p><strong>Blueprint</strong><br />routing관리에 이용한다.<br />application/feedback 폴더에 모듈을 넣을 경우.<br /><code><br />from flask import Blueprint<br />mod = Blueprint('root', __name__, url_prefix='') // prefix를 공란으로 두면 root를 의미한다.<br />mod = Blueprint('feedback', __name__, url_prefix='/feedbacks')  // prefix를 채우면 route('/')가 해당 prefix와 같다.<br />@mod.route('/')<br /></code><br />새로운 디렉토리를 만들고 __init__.py파일을 추가해야 import시 인식한다.</p><p>모듈을 사용하려면 어플리케이션에서 등록해 준다.<br /><code><br />from application.feedback.views import mod as feedbacksModule<br />app.register_blueprint(feedbacksModule)<br /></code></p><p><strong>파일 여러개 올리기(Uploading multiple files with Flask)</strong><br /><a title="flask 에서 파일 여러개 올리기" href="http://stackoverflow.com/questions/11817182/uploading-multiple-files-with-flask" target="_blank">http://stackoverflow.com/questions/11817182/uploading-multiple-files-with-flask</a></p><p><code><br />@app.route("/upload", methods=["POST"])<br />def upload():<br />uploadedfiles = flask.request.files.getlist("file[]")<br />print uploadedfiles<br />return ""<br /></code></p><p><strong>동적으로 생성된 이미지 파일의 url 받기(How to get url for dynamically generated image file?)</strong><br /><a title="동적으로 생성된 이미지 파일의 url 받기(How to get url for dynamically generated image file?)" href="http://stackoverflow.com/questions/12034949/flask-how-to-get-url-for-dynamically-generated-image-file" target="_blank">http://stackoverflow.com/questions/12034949/flask-how-to-get-url-for-dynamically-generated-image-file</a><br /><code><br />@app.route("/imgs/")<br />def images(path):<br />generateimg(path)<br />fullpath = "./imgs/" + path<br />resp = flask.makeresponse(open(fullpath).read())<br />resp.content_type = "image/jpeg"<br />return resp<br /></code></p><p>mydomain.com/static/test.jpg<br /><code><br />from flask import Flask, redirect, url_for<br /><br />app = Flask(__name__)<br />@app.route('/')<br />def index():<br />generate_img("test.jpg"); #save inside static folder<br />return '&lt;img src=' + url_for('static',filename='test.jpg') + '&gt;'<br /></code></p><p><strong>Jade</strong><br />두개의 속성을 지정할 땐 콤마(,)를 잊지 않는다.<br /><code><br />script(data-main='js/app', src='js/vendor/require.js')<br /></code></p>
