---
layout: IT
title: "[RoR] Ruby Gems Cheat Sheet"
date: '2012-06-26'
comments: true
adsense: true
ignored: true
tags:
- cheat
- gem
- IT
- rails
- RoR
- ruby
- sheet
- web
---

<h2 id="article_summary" class="summary">Ruby Gems Cheat Sheet</h2><br /><h3>GEM 설정</h3><code>gem environment<br />set GEM_PATH = D:\dev\ruby192\lib\ruby\gems\1.9.1\gems<br />gem update --system<br />gem uninstall gemname<br />bundle update<br />(vendor 폴더에 bundle 설치하기)<br />bundle install --path vendor/bundle<br /></code><br /><br /><h3>devise</h3><h4>Controller filters and helpers</h4><code>Devise will create some helpers to use inside your controllers and views. To set up a controller with user authentication, just add this before_filter:<br />before_filter :authenticate_user!<br />To verify if a user is signed in, use the following helper:<br />user_signed_in?<br />For the current signed-in user, this helper is available:<br />current_user<br />You can access the session for this scope:<br />user_session<br />Callbacks<br />&nbsp;&nbsp;&nbsp; after_set_user<br />&nbsp;&nbsp;&nbsp; after_authentication<br />&nbsp;&nbsp;&nbsp; before_failure<br />&nbsp;&nbsp;&nbsp; before_logout<br />&nbsp;&nbsp;&nbsp; Warden::Manager.after_authentication do |user,auth,opts|<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; user.last_login = Time.now<br />&nbsp;&nbsp;&nbsp; end<br />&nbsp;&nbsp;&nbsp;<br /></code><br /><h4>generator</h4><code>devise g view with haml<br />rails g devise_views -t=haml<br /></code><br /><h4>OmniAuth</h4><code>Add :password =&gt; Devise.friendly_token[0,20] when creating a new user from facebook omniauth.<br /></code><br /><h4>Passwords Encrypt manually</h4><code><br />Assuming you have a mysql database with a "users" table and a "password" column And an ActiveRecord model class called "user" that is hooked up to devise<br />Create an ActiveRecord model class in your app app/models/old_user.rb<br />OldUser &lt; ActiveRecord::Base<br />&nbsp; set_table :users<br />&nbsp; establish_connection :database =&gt; "old_database", :user =&gt; "old user", :adapter =&gt; "mysql"<br />end<br />then create a rake task: app/lib/tasks/migrate_users.rake<br />task :migrate_users =&gt; :environment do<br />&nbsp; OldUser.find_each do |old_user|<br />&nbsp;&nbsp;&nbsp; u = User.new(:email =&gt; old_user.email, :password =&gt; old_user.password, :password_confirmation =&gt; old_user.password);<br />&nbsp;&nbsp;&nbsp; #if your using confirmation<br />&nbsp;&nbsp;&nbsp; u.skip_confirmation!<br />&nbsp;&nbsp;&nbsp; u.save!<br />&nbsp; end<br />end<br />Modify as necessary (make sure you're saving any app-specific user attributes)<br />Then$ rake migrate_users<br />&nbsp;&nbsp;&nbsp;<br />Good news and bad news.<br />Good news:<br />The following works to create your user's password manually.<br />&nbsp;pepper = nil<br />&nbsp;cost = 10<br />&nbsp;encrypted_password = ::BCrypt::Password.create("#{password}#{pepper}", :cost =&gt; cost).to_s<br />You can find your pepper and cost in your devise initializer. This method was confirmed using Devise's "valid_password?" method.<br />Bad news:<br />The entire reason I was trying to avoid "User.new(password: password).encrypted_password" was because of speed. It's terribly slow. With all my other pieces of my import task, I've intentionally avoided this.<br />But as it turns out, the major cost here is not instantiating a User object -- but BCrypt itself. There is very little noticeable speed boost when using BCrypt directly because it's intentionally designed to be slow.<br />My final answer: suck it up, run the rake script, go find a beverage.<br /></code><br /><h4>mailer locale configuration</h4><code>-ActionMailer::Base.default_url_options[:locale] = I18n.locale<br /></code><br /><br /><h3>Simple_form</h3><code>&lt;%= simple_form_for(@user, :builder =&gt; CustomBuilder) do |f| %&gt;<br />&nbsp; &lt;%= f.input :name %&gt;<br />&lt;% end %&gt;<br /></code><br /><br /><h3>Client side validations</h3><code>Client side validations Registering own form builder<br />https://github.com/bcardarella/client_side_validations/wiki/Registering-your-own-custom-form-builder<br /></code><br /><br /><h3>Client MVC</h3><h4>Spine</h4><code>Important is only that the public directory of the application is specified<br />as domainroot in Confixx. If the domain is called Passenger will start automatically.."<br />rails g spine:model Card text is_private order user_id card_type<br />rails g spine:controller Cards<br />rails g spine:scaffold card text is_private order user_id card_type<br />rails g spine:model Organization title description url image admins members followers<br />rails g spine:controller Organizations<br />rails g spine:scaffold organization title description url image admins members followers<br />var card = App.Card.create({&nbsp;<br />&nbsp; is_private: true,<br />&nbsp; order: 0,<br />&nbsp; card_type: 'Reason',<br />&nbsp; text: 'Spine &amp; Rails, sitting in a tree!'<br />});<br />straightforward way to do that without extending Spine Model's<br />to allow for instances to be added in memory without syncing<br />Ajax.disable -&gt; saveStuff()<br />Model.refresh()<br />extends<br />Contact.extend(Spine.Model.Ajax);<br />Contact.extend({<br />url: '/users/'<br />});<br />'/': -&gt;<br />&nbsp;&nbsp;&nbsp; if AuthenticatedUser<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @controller = new OtherController<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @replace @controller.render()<br />&nbsp;&nbsp;&nbsp; else<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @controller = new LoginController<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @replace @controller.render()<br />http://spinejs.com/docs/controller_patterns&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br />&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<br /></code><br /><br /><h3>Compass</h3><code>compass init rails D:/dev/workspace/baksisi<br />compass init rails -r html5-boilerplate -u html5-boilerplate --syntax sass --force<br />css와 javascript를 asset 폴더로 옮겨준다. rails.js는 제외 (jquery_ujs와 동일하다)<br /></code><br /><br /><h3>Geo_location</h3><code>https://github.com/chrisyour/geo_location<br />http://www.maxmind.com/app/geolitecountry<br /></code><br /><br /><h3>Mongoid id 변경하기</h3><code>http://blog.joshdzielak.com/blog/2011/12/24/tame-the-mongoid-id-field-in-your-rails-and-backbone-js-app/<br />http://lostechies.com/derickbailey/2011/06/17/making-mongoid-play-nice-with-backbone-js/<br /></code><br /><br /><h3>Mongoid Follow unfollow</h3><code>class User<br />&nbsp; include Mongoid::Document<br />&nbsp; field :name, type: String<br />&nbsp; has_and_belongs_to_many :following, class_name: 'User', inverse_of: :followers, autosave: true<br />&nbsp; has_and_belongs_to_many :followers, class_name: 'User', inverse_of: :following<br />&nbsp; def follow!(user)<br />&nbsp;&nbsp;&nbsp; if self.id != user.id &amp;&amp; !self.following.include?(user)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self.following &lt;&lt; user<br />&nbsp;&nbsp;&nbsp; end<br />&nbsp; end<br />&nbsp; def unfollow!(user)<br />&nbsp;&nbsp;&nbsp; !self.following.include?(user)<br />&nbsp;&nbsp;&nbsp; self.following.delete(user)<br />&nbsp; end&nbsp;&nbsp;&nbsp;&nbsp;<br />end<br />relation_ids instead? that is self.member_count = self.member_ids.size<br />self.challenged.where(_id: event.id).destroy_all<br />def unchallenge!(announce)<br />&nbsp; self.announcements.destroy_all( conditions: { _id: announce.id })<br />&nbsp; self.save!<br />end<br />Finally I successfully deleted the relation using self.challenged_ids.delete(event.id)<br />validates_inclusion_of :foo, in: [['foo'], ['bar']]<br /></code><br /><br /><h3>Mongoid polymorphic behaviour</h3><code>When a child embedded document can belong to more than one type of parent document, you can tell Mongoid to support this by adding the as option to the definition on the parents, and the polymorphic option on the child.<br />class Doctor<br />&nbsp; include Mongoid::Document<br />&nbsp; embeds_one :name, as: :namable<br />end<br />class Nurse<br />&nbsp; include Mongoid::Document<br />&nbsp; embeds_one :name, as: :namable<br />end<br />class Name<br />&nbsp; include Mongoid::Document<br />&nbsp; embedded_in :namable, polymorphic: true<br />end<br /></code><br /><br /><h3>TEST</h3><h4>Cucumber</h4><code>rails g cucumber:install ?capybara ?rspec<br />&nbsp; ruby script/rails generate cucumber:feature user email:string password:string confirm_password:string name:string nickname:string gender:integer location_name:string location:integer email_is_priavate:boolean name_is_private:boolean danted:boolean description:string<br />&nbsp; ruby script/rails generate scaffold post title:string body:text published:boolean<br />&nbsp; rake db:migrate<br />&nbsp; rake cucumber<br /></code><br /><br /><h4>Cucumber Errors Handling</h4><code>If SystemStackError: stack level too deep&nbsp;<br />Then add gem "rspec", "&gt;= 2.6.0.rc2", :group =&gt; [:development, :test] to Gemfile<br /></code><br /><br /><h4>Cucumber &amp; Capybara Ajax</h4><code>sleep second<br />page.driver.browser.execute_script %Q{ $('.ui-menu-item a:contains("#{link_text}")').trigger("mouseenter").click(); }<br />Clicking any element with Cucumber and Capybara<br />class Capybara::XPath<br />&nbsp; class &lt;&lt; self<br />&nbsp;&nbsp;&nbsp; def element(locator)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; append("//*[normalize-space(text())=#{s(locator)}]")<br />&nbsp;&nbsp;&nbsp; end<br />&nbsp; end<br />end<br />When 'I click "$locator"' do |locator|<br />&nbsp; msg = "No element found with the content of '#{locator}'"<br />&nbsp; locate(:xpath, Capybara::XPath.element(locator), msg).click<br />end<br />The step looks for any element with the given text. Here it is in use:<br />Scenario: Creating an item<br />&nbsp; Given I am signed in as "brandon@example.com"<br />&nbsp;&nbsp; When I click "Add to your list"<br />&nbsp;&nbsp;&nbsp; And I fill in "Description" with "blog about clicking any element"<br />&nbsp;&nbsp;&nbsp; And I press enter<br />&nbsp;&nbsp; Then I should see "The item was added to your list"<br />&nbsp;&nbsp;&nbsp; And I should see "blog about clicking any element"<br />&nbsp;&nbsp;&nbsp;<br /></code><br /><br /><h4>Cucumber Capybara</h4><code>selenium chrome driver<br />https://github.com/jnicklas/capybara<br />http://code.google.com/p/chromium/downloads/list<br />http://code.google.com/p/selenium/wiki/ChromeDriver#Overriding_the_Chrome_binary_location<br />Capybara.register_driver :selenium_with_firebug do |app|<br />&nbsp; Capybara::Driver::Selenium<br />&nbsp; profile = Selenium::WebDriver::Firefox::Profile.new<br />&nbsp; profile.add_extension(File.expand_path("features/support/firebug-1.6.0-fx.xpi"))<br />&nbsp; Capybara::Driver::Selenium.new(app, { :browser =&gt; :firefox, :profile =&gt; profile })<br />end<br />Before("@selenium_with_firebug") do<br />&nbsp; Capybara.current_driver = :selenium_with_firebug<br />end<br /></code><br /><br /><h3>I18n</h3><h4>I18n-js initialize</h4><code>layout/application.html.haml<br />- html_tag :class =&gt; 'no-js', :lang =&gt; "#{I18n.locale}"<br />applcation.js<br />I18n.default_locale = "en"<br />I18n.locale = $($("html")[0]).prop("lang")<br />I18n.fallbacks = true<br /></code><br /><br /><h3>Media - Flickraw</h3><code>&nbsp;&nbsp;&nbsp; flickr.upload_photo(params[:photo].tempfile.path)<br /></code><br /><br /><h3>Gem Trouble shooting</h3><code>Q. `require': no such file to load -- thin (LoadError)<br />A. =&gt; Add gem 'thin' to Gemfile</code><br /><br /><h3>Rails Performance</h3><ul><li>Curb for Http (libcurl)</li><li>Yajl, the fastest JSON library.</li><li>excon #=> faster http</li><li>Nokogiri, the fastest XML library.</li><li>Snappy, super fast compression tool by google.</li><li>fast_xs</li><li>Memcache. (libmemcached)</li><li>use Ree Garbage Collector</li></ul><br /><h3>Fastest Server</h3><ul><li>Unicorn</li><li>Thin</li></ul><br /><h3>Profiling Tools</h3><ul><li><a href="http://newrelic.com" target="_blank" title="NewRelic">NewRelic</a> - Monitoring Tool (Commercial)</li><li><a href="http://ganglia.info" target="_blank" title="Ganglia">Ganglia</a> - Monitoring Tool (OpenSource)</li><li><a href="http://www.cloudflare.com" target="_blank" title="Cloudflare">Cloudflare </a> - Performance & Security</li><li>rack-perftools</li></ul><br /><h4>Rack-bug</h4><code>1. Install rack-bug (branch rails3) as plugin<br />cd vendor/plugins<br />git clone -b rails3 https://github.com/brynary/rack-bug.git<br />If you want to you it as gem then add following line into Gemfile<br />gem 'rack-bug', :git => 'https://github.com/brynary/rack-bug.git', :branch => 'rails3'<br />2. Replace the code from file actionview_extension.rb<br />which is avilable in vendor/plugins/rack-bug/lib/rack/bug/panels/templates_panel/ as specified in bug of rack_bug repository<br />if defined?(ActionView) && defined?(ActionView::Template)<br />ActionView::Template.class_eval do<br />def render_with_rack_bug(*args, &block)<br />Rack::Bug::TemplatesPanel.record(virtual_path) do<br />render_without_rack_bug(*args, &block)<br />end<br />end<br />alias_method_chain :render, :rack_bug<br />end<br />end<br />If you are using gem override the specified file in some way<br />3. Add following lines into your config.ru<br />require 'rack/bug'<br />use Rack::Bug, :secret_key => "someverylongandveryhardtoguesspreferablyrandomstring"<br />run myapp<br />4. Start your server and access the URL http://your_app/__rack_bug__/bookmarklet.html<br />and enter the password.<br />http://blog.railsupgrade.com/2011/04/configure-rack-bug-for-rails-3.html   <br /></code><br /><br /><h3>출처</h3><ul><li>직접 작성</li><li><a href="http://rubygems.org/" target="_blank" title="rubygems.org">rubygems.org</a></li><li><a href="http://stackoverflow.com" target="_blank" title="Stack Overflow">Stack Overflow</a></li><li>google 검색</li></ul>
