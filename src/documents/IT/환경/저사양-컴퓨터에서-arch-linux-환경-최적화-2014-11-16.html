---
layout: IT
title: "저사양 컴퓨터에서 Arch linux  환경 최적화"
date: '2014-11-16'
comments: true
adsense: true
ignored: true
tags:
- arch
- IT
- linux
- "설정"
- "저사양"
- "최적화"
- "환경"
---

<h2 id="article_summary" class="summary">4G램 이하에서 Arch linux를 데스크탑으로 쓰기 위한 최적화.</h2><p>램이 4G라면 적은 건 아니다. 하지만 무거운 프로그램을 돌리려면 부족한 게 사실이다. 이를 해결하려고 Desktop Environment을 바꿔 보았지만 별 효과를 보지 못했다. 그래서 몇 가지 더 손을 본 결과 쓸만한 데스크탑 환경을 구축했다.</p><p>가장 큰 효과를 본 것은 스왑 메모리의 설정이었다. SSD에 자주 쓰고 지우면 수명이 단축된다고 하지만, 내 수명이 단축되지 않으려면 스왑을 써야했다. 스왑영역을 잡아주었더니, 버츄어 박스와 IDE 크롬과 파이어폭스를 띄워도 시스템이 멈추지 않는다.</p><h3>스왑 할당하기</h3><p>우선 아래 명령어로 할당된 스왑을 확인한다.<br /><code>sudo swapon -s<br />free -m</code></p><p>공간이 충분히 남아있는지도 확인한다.<br /><code>df -h</code></p><p>스왑 파일을 만든다.<br /><code>sudo fallocate -l 4G /swapfile</code></p><p>root 유저만 읽고 쓰도록 스왑 파일의 권한을 설정한다.<br /><code>sudo chmod 600 /swapfile</code></p><p>스왑 파일이 잘 만들어 졌는지 확인한다.<br /><code>ls -lh /swapfile</code></p><p>스왑 영역을 할당한다.<br /><code>sudo mkswap /swapfile</code></p><p>스왑 영역을 활성화한다.<br /><code>sudo swapon /swapfile</code></p><p>아래 명령어로 할당된 스왑을 확인한다.<br /><code>sudo swapon -s<br />free -m</code></p><p>/etc/fstab 파일에 스왑 설정을 추가한다.<br /><code>/swapfile none swap sw 0 0</code></p><p>/etc/sysctl.conf 파일에 다음을 추가한다.<br /><code>vm.swappiness=10<br />vm.vfs_cache_pressure = 50</code></p><p>스왑 영역을 지울 땐 아래 명령어를 쓰면 된다.<br /><code>swapoff -a<br />rm -f /swapfile</code></p><ul><li><a href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-ubuntu-14-04" target="_blank">https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-ubuntu-14-04</a></li></ul><h3>gnome-pty-helper 비활성화</h3><p>사용자가 얼마나 많은 터미널을 열었나 기록하는 헬퍼로 데스크톱 환경에서는 필요가 없다.</p><p><code>chmod 644 /usr/lib/vte/gnome-pty-helper<br />chmod 644 /usr/lib64/vte/gnome-pty-helper<br />chmod 644 /lib64/vte/gnome-pty-helper<br />chmod 644 /lib/vte/gnome-pty-helper</code></p><ul><li><a href="https://wiki.manjaro.org/index.php?title=Getridofthegnome-pty-helper_process" target="_blank">https://wiki.manjaro.org/index.php?title=Get<em>rid</em>of<em>the</em>gnome-pty-helper_process</a></li></ul><h3>Core dump 비활성화</h3><p>코어 덤프가 디버깅엔 유용하지만 평소에는 성능에 저하를 가져오므로 비활성화 한다.<br />/etc/sysctl.conf 파일에 다음을 추가한다.<br /><code>fs.suid_dumpable = 0</code></p><ul><li><a href="https://wiki.archlinux.org/index.php/Core_dump" target="_blank">https://wiki.archlinux.org/index.php/Core_dump</a></li></ul><h3>SSD trim 기능 켜기</h3><p><code>sudo pacman -S util-linux<br />sudo systemctl enable fstrim.timer</code></p><ul><li><a href="https://wiki.archlinux.org/index.php/SolidStateDrives%20trim" target="_blank">https://wiki.archlinux.org/index.php/Solid<em>State</em>Drives trim</a></li></ul><p>윈도우 메니저의 변경이 도움이 될 수도 있다.<br />가벼운 윈도우 메니져가 많다. FVWM과 ICEWM이 가벼운 편이었지만, 보기가 너무 안좋아서 지워버렸다. OpenBox는 좋은 모습을 보여주지만 XFCE의 기본 WM인 XFWM(14M)보다 두배가 넘는 메모리(31M)를 사용한다. 그래도 여전히 가벼운 편이니 취향에 따라 OpenBox로 윈도우메니져를 바꿔 보는 것도 괜찮겠다.</p><h3>xfce 윈도우 메니저 변경하기</h3><h4>설정 파일을 가져온다.</h4><p><code>cp /etc/xdg/xfce4/xfconf/xfce-perchannel-xml/xfce4-session.xml ~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-session.xml</code></p><h4>~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-session.xml 파일을 열어 xfwm4를 openbox로 변경한다.</h4><p><code>&lt;value type="string" value="xfwm4"/&gt;</code>to<br /><code>&lt;value type="string" value="window_manager_executable"/&gt;</code><br /></p><h4>오픈박스용 설정 설치</h4><p><code>pacman -S obconf</code></p><p>단축키가 제대로 동작하지 않으면 vi .config/openbox/rc.xml 에서 사용하지 않는 단축키를 제거한다.</p><h4>지금 사용하는 윈도우 메니저 보기</h4><p><code>pacman -S wmctrl<br />wmctrl -m</code></p><ul><li><a href="http://l3net.wordpress.com/2014/02/15/a-memory-comparison-of-light-linux-desktops-part-3/" target="_blank">http://l3net.wordpress.com/2014/02/15/a-memory-comparison-of-light-linux-desktops-part-3/</a></li><li><a href="http://openbenchmarking.org/result/1404130-PL-PERFORMAN65" target="_blank">http://openbenchmarking.org/result/1404130-PL-PERFORMAN65</a></li><li><a href="https://wiki.archlinux.org/index.php/Xfce#Defaultwindowmanager" target="_blank">https://wiki.archlinux.org/index.php/Xfce#Default<em>window</em>manager</a></li><li><a href="https://wiki.archlinux.org/index.php/Compton" target="_blank">https://wiki.archlinux.org/index.php/Compton</a></li><li><a href="http://www.slant.co/topics/390/~what-are-the-best-window-managers-for-linux" target="_blank">http://www.slant.co/topics/390/~what-are-the-best-window-managers-for-linux</a></li></ul><h3>가볍고 쓸만한 앱을 찾다가 보조 터미널로 좋은 tilda와 자원 점유율을 보여주는 htop을 설치했다.</h3><p><code>pacman -S tilda<br />pacman -S htop</code></p><br /><p>혹시 이 환경에서도 시스템이 불안정한 일이 자주 발생한다면 쓰는 자주 프로그램을 가벼운 걸로 바꾸어 보는 것도 괜찮을 것 같다. 예를 들면 이메일 클라이언트를 썬더버드에서 Trojita나 Geary등으로 바꾸는 것이다. 하지만 설정을 다시 하기는 귀찮으니 우선은 이대로 써야겠다.</p><br /><h3>문제 해결</h3><h4>키보드 단축키가 작동하지 않을 때</h4><p>로그아웃 하고 tty1(ctrl+alt+F1)에서 로그인 하여 rm -rf ~/.cache/sessions/* 로 세션 캐쉬를 삭제한다.</p><h4>Failed to fork (Resource temporarily unavailable) 오류가 날 때</h4><p>/etc/sysctl.conf 파일에 다음을 추가한다.<br /><code>fs.file-max = 204708</code></p><ul><li><a href="http://stackoverflow.com/questions/12079087/fork-retry-resource-temporarily-unavailable" target="_blank">http://stackoverflow.com/questions/12079087/fork-retry-resource-temporarily-unavailable</a></li></ul><h4>QT5에서 한글 입력이 안될 때</h4><p><code>yaourt -S uim-qt5 --force</code></p><h4>SHELL의 변경 (zsh)</h4><p><code>pacman -S zsh<br />zsh /usr/share/zsh/functions/Newuser/zsh-newuser-install -f<br />chsh -s $(which zsh)<br />echo $SHELL</code></p><ul><li><a href="https://wiki.archlinux.org/index.php/zsh" target="_blank">https://wiki.archlinux.org/index.php/zsh</a></li><li><a href="https://wiki.archlinux.org/index.php/Zsh#Key_bindings" target="_blank">https://wiki.archlinux.org/index.php/Zsh#Key_bindings</a></li></ul><h4>재부팅 하지 않고 sysctl 적용</h4><p><code>sudo sysctl -p /etc/sysctl.d/99-sysctl.conf</code></p><h3>그 밖에 읽어볼 만한 자료.</h3><ul><li><a href="http://wongdev.com/blog/most-popular-arch-linux-apps-2013/" target="_blank">http://wongdev.com/blog/most-popular-arch-linux-apps-2013/</a></li></ul><h3>SSD 최적화</h3><ul><li><a href="https://wiki.debian.org/SSDOptimization#Addingvm.swappinessinsysctlforthekernel" target="_blank">https://wiki.debian.org/SSDOptimization#Adding<em>vm.swappiness</em>in<em>sysctl</em>for<em>the</em>kernel</a></li><li><a href="http://www.leaseweblabs.com/2013/07/5-crucial-optimizations-for-ssd-usage-in-ubuntu-linux/" target="_blank">http://www.leaseweblabs.com/2013/07/5-crucial-optimizations-for-ssd-usage-in-ubuntu-linux/</a></li></ul><h4>베터리를 오래가게 돕는 도구</h4><ul><li><a href="https://aur.archlinux.org/packages/laptop-mode-tools" target="_blank">https://aur.archlinux.org/packages/laptop-mode-tools</a></li></ul><h4>실행중인 프로세스가 어떻게 자원을 사용할 지 제어하는 데몬</h4><ul><li><a href="https://wiki.archlinux.org/index.php/Ulatencyd" target="_blank">https://wiki.archlinux.org/index.php/Ulatencyd</a></li><li><a href="http://blog.garillot.net/post/43139769034/how-a-ram-disk-saved-my-life" target="_blank">http://blog.garillot.net/post/43139769034/how-a-ram-disk-saved-my-life</a></li></ul>
