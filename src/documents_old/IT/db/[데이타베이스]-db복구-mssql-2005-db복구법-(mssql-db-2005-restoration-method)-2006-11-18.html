---
layout: IT
title: "[데이타베이스] DB복구. MSSQL 2005 DB복구법 (MSSQL DB 2005 restoration method)"
date: '2006-11-18'
comments: true
adsense: true
ignored: false
tags:
- database
- db
- db restoration
- IT
- MSSQL
- "데이타베이스 복구"
- "복구법"
---

<script src='http://ss.textcube.com/service/blog/script/blogger.js' type='text/javascript'></script><div class="imageblock left" style="float: left; text-align: center; padding: 10px;"><img src="http://images.google.com/images?q=tbn:F07Zp85mVJZVGM::mehmet-ozdemir.com.tr/Upload/Images/3860635301.03.LZZZZZZZ.jpg" alt="DB복구. MSSQL 2005 DB복구법 (MSSQL DB 2005 restore method)[DB복구,MSSQL,2005,복구방법,DB되살리기,데이타베이스,database]" height="130" width="99"><p style="margin-top: 5px;"><span>이미지출처</span>&nbsp;: <a href="http://mehmet-ozdemir.com.tr/Posts.aspx?PostID=86" onclick="window.open(this.href);return false;"><span style="color: rgb(0, 128, 0);">mehmet-ozdemir.com.tr</span></a></p></div>수백기가의 데이터베이스가! 갑자기 번개를 한번 맞더니 몽땅 날아가버렸다면..<br /><br /><p>정말 토나오는 일이다.-_-;</p><br /><br /><p>하지만 복구 할 수 있는 길은 열려있었으니..</p><br /><br /><p>1. 로그와 데이터 모두 살아있을 때 복구법 : sp_attach_db ‘DB명’, ‘경로\파일명.mdf’ , ‘경로\파일명_log.ldf’<br /><br />2. 데이터 파일만 살아있을 때 복구법        : sp_attach_single_file_db ‘DB명’, ‘경로\파일명.mdf’<br /><br />3. 데이터 파일만 남기고 삭제하고 싶을때 : sp_detach_db</p><br /><br /><p>이 방법들은 정상적으로 종료가 되었을때만 사용 가능하다.</p><br /><br /><p>번개를 맞아서 컴퓨터가 다운되었다면, 이 방법은 안통한다.</p><br /><br /><p>그런일이 있다면 다행히 ldf파일만 손상을 입고 mdf파일은 손상을 입지 않았다면 복구 할 수 있는 방법이 있다.</p><br /><br /><p>- 원래 DB와 동일 이름의 DB를 생성한다. (mdf 파일명과 크기도 같게..)<br /><br />- 생성한 DB를 긴급 모드로 변경한다. : alter database dbname set emergency<br /><br />- SQL 서버를 멈춘다.<br /><br />- 생성한 DB의 mdf,ldf파일을 삭제하고 복구할 mdf파일들을 복사해온다.(로그파일 제외)<br /><br />- SQL 서버를 재시동한다.<br /><br />- 오브젝트와 데이터들이 관리자에게 접근가능하지만, 여전히 백업도 안되고 온라인상태가 되지도 않는다.<br /><br />- 스크립트 생성 마법사로 모든데이터 오브젝트를 스크립트로 만든다.(스크림팅 오브젝트 권한,의존 오브젝트들,인덱스들 포함;파일로 내보낸다.)<br /><br />- 새로운 두번째 DB를 생성한다.<br /><br />- 새로운 DB에서 모든 오브젝트가 생성되 때까지 여러번 스크립트를 실행한다.<br /><br />- 데이터 불러오기 마법사로 모든 살아있는 테이블을 새로운 DB에 넣는다.<br /><br />- 새로운 DB를 백업하고 긴급모드에 들어가있는 DB에 복원한다.</p><br /><br /><p>끝!</p><p><br /></p><p><br /></p><p>----</p><p id="more-143-0" class="moreless_fold" style="color: #000000; padding: 0 0 0 10px;"><span style="cursor: pointer;" onclick="if (window.TC$PRIV_toggleMoreLessBlogger != undefined) {TC$PRIV_toggleMoreLessBlogger(this, '143-0','Open english content','Close english content'); return false;} else {document.getElementById('content-143-0').style.display='';}">       Open english content</span></p><div id="content-143-0" class="moreless_content" style="display: none; border: 1px dashed #cccccc; background-color: #f3f3f3; margin: 0 10px padding: 5px;"><p>If you undergo lost your all data for thunder..</p><br /><br /><p>That’s really crap.</p><br /><br /><p>But we have open way.</p><br /><br /><p>1. Have mdf&amp;ldf   : sp_attach_db ‘DB name’, ‘path\fileName.mdf’ , ‘path\fileName_log.ldf’<br /><br />2. Have mdf only : sp_attach_single_file_db ‘DB name’, ‘path\fileName.mdf’<br /><br />3. Wanna delete DB except mdf : sp_detach_db</p><br /><br /><p>However, it just general cases.<br /><br />If you got thunder, it’s impossible</p><br /><br /><p>But, If you have good mdf file, refer to the following Steps~</p><br /><br /><p>- Create a new database with the same name and logical file names<br /><br />- Put this database in emergency mode: alter database dbname set emergency<br /><br />- Stop SQL Server<br /><br />- Delete the new database’s mdf and ldf files, replace with a copy of the<br /><br />rescued mdf (no log)<br /><br />- Restart SQL Server<br /><br />- Objects and data are now accessible to one administrator, though this<br /><br />database still cannot be backed up or brought online<br /><br />- Use the Generate Scripts wizard to script all database objects (include<br /><br />scripting object permissions, dependent objects, indexes; output to a file)<br /><br />- Create a second new database<br /><br />- Run the object creation script in the new database two or three times<br /><br />until all objects are created, making adjustments if necessary<br /><br />- Use the Import Data wizard to copy data from all rescued tables into the<br /><br />new database<br /><br />- Backup the new database and restore it in place of the emergency db</p><br /><br /><p>END!</p></div><br />
